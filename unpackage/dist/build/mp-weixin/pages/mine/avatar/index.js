(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/mine/avatar/index"],{"1daf":function(t,e,a){"use strict";(function(t){a("0146");c(a("66fd"));var e=c(a("e00f"));function c(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=a,t(e.default)}).call(this,a("543d")["createPage"])},"20bc":function(t,e,a){"use strict";var c=a("af9f"),i=a.n(c);i.a},"2c53":function(t,e,a){"use strict";var c;a.d(e,"b",(function(){return i})),a.d(e,"c",(function(){return r})),a.d(e,"a",(function(){return c}));var i=function(){var t=this,e=t.$createElement;t._self._c},r=[]},"43ff":function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var c=u(a("574a")),i=u(a("4761")),r=a("d7a9");function u(t){return t&&t.__esModule?t:{default:t}}var n,s,o,h,p,f,d,l,g,v,m,T=c.default.baseUrl,b=t.getSystemInfoSync(),L=b.screenWidth,R=(b.pixelRatio,1),I=100,W=b.screenWidth,_={data:function(){return{imageSrc:i.default.getters.avatar,isShowImg:!1,cropperInitW:L,cropperInitH:L,cropperW:L,cropperH:L,cropperL:0,cropperT:0,transL:0,transT:0,scaleP:0,imageW:0,imageH:0,cutL:0,cutT:0,cutB:L,cutR:"100%",qualityWidth:W,innerAspectRadio:R}},onReady:function(){this.loadImage()},methods:{setData:function(t){var e=this;Object.keys(t).forEach((function(a){e.$set(e.$data,a,t[a])}))},getImage:function(){var e=this;t.chooseImage({success:function(t){e.setData({imageSrc:t.tempFilePaths[0]}),e.loadImage()}})},loadImage:function(){var e=this;t.getImageInfo({src:e.imageSrc,success:function(a){g=1,g>=1?(v=L,m=L/g):(v=L*g,m=L);var c=v>m?v:m;if(I=c>I?I:c,g>=1){var i=Math.ceil((L/g-(L/g-I))/2),r=i,u=Math.ceil((L-L+I)/2),n=u;e.setData({cropperW:L,cropperH:L/g,cropperL:Math.ceil((L-L)/2),cropperT:Math.ceil((L-L/g)/2),cutL:u,cutT:i,cutR:n,cutB:r,imageW:v,imageH:m,scaleP:v/L,qualityWidth:W,innerAspectRadio:g})}else{var s=Math.ceil((L*g-L*g)/2),o=s,h=Math.ceil((L-I)/2),p=h;e.setData({cropperW:L*g,cropperH:L,cropperL:Math.ceil((L-L*g)/2),cropperT:Math.ceil((L-L)/2),cutL:s,cutT:h,cutR:o,cutB:p,imageW:v,imageH:m,scaleP:v/L,qualityWidth:W,innerAspectRadio:g})}e.setData({isShowImg:!0}),t.hideLoading()}})},contentStartMove:function(t){n=t.touches[0].pageX,s=t.touches[0].pageY},contentMoveing:function(t){var e=(n-t.touches[0].pageX)*R,a=(s-t.touches[0].pageY)*R;e>0?this.cutL-e<0&&(e=this.cutL):this.cutR+e<0&&(e=-this.cutR),a>0?this.cutT-a<0&&(a=this.cutT):this.cutB+a<0&&(a=-this.cutB),this.setData({cutL:this.cutL-e,cutT:this.cutT-a,cutR:this.cutR+e,cutB:this.cutB+a}),n=t.touches[0].pageX,s=t.touches[0].pageY},contentTouchEnd:function(){},getImageInfo:function(){var e=this;t.showLoading({title:"图片生成中..."});var a=t.createCanvasContext("myCanvas");a.drawImage(e.imageSrc,0,0,v,m),a.draw(!0,(function(){var a=(e.cropperW-e.cutL-e.cutR)/e.cropperW*v,c=(e.cropperH-e.cutT-e.cutB)/e.cropperH*m,u=e.cutL/e.cropperW*v,n=e.cutT/e.cropperH*m;t.canvasToTempFilePath({x:u,y:n,width:a,height:c,destWidth:a,destHeight:c,quality:.5,canvasId:"myCanvas",success:function(e){t.hideLoading();var a={name:"avatarfile",filePath:e.tempFilePath};(0,r.uploadAvatar)(a).then((function(e){i.default.commit("SET_AVATAR",T+e.imgUrl),t.showToast({title:"修改成功",icon:"success"}),t.navigateBack()}))}})}))},dragStart:function(t){o=t.touches[0].pageX,h=t.touches[0].pageY,p=this.cutL,d=this.cutR,l=this.cutB,f=this.cutT},dragMove:function(t){var e=t.target.dataset.drag;switch(e){case"right":var a=(o-t.touches[0].pageX)*R;d+a<0&&(a=-d),this.setData({cutR:d+a});break;case"left":a=(o-t.touches[0].pageX)*R;p-a<0&&(a=p),p-a>this.cropperW-this.cutR&&(a=p-(this.cropperW-this.cutR)),this.setData({cutL:p-a});break;case"top":a=(h-t.touches[0].pageY)*R;f-a<0&&(a=f),f-a>this.cropperH-this.cutB&&(a=f-(this.cropperH-this.cutB)),this.setData({cutT:f-a});break;case"bottom":a=(h-t.touches[0].pageY)*R;l+a<0&&(a=-l),this.setData({cutB:l+a});break;case"rightBottom":var c=(o-t.touches[0].pageX)*R,i=(h-t.touches[0].pageY)*R;l+i<0&&(i=-l),d+c<0&&(c=-d);var r=l+i,u=d+c;this.setData({cutB:r,cutR:u});break;default:break}}}};e.default=_}).call(this,a("543d")["default"])},5318:function(t,e,a){"use strict";a.r(e);var c=a("43ff"),i=a.n(c);for(var r in c)"default"!==r&&function(t){a.d(e,t,(function(){return c[t]}))}(r);e["default"]=i.a},af9f:function(t,e,a){},e00f:function(t,e,a){"use strict";a.r(e);var c=a("2c53"),i=a("5318");for(var r in i)"default"!==r&&function(t){a.d(e,t,(function(){return i[t]}))}(r);a("20bc");var u,n=a("f0c5"),s=Object(n["a"])(i["default"],c["b"],c["c"],!1,null,null,null,!1,c["a"],u);e["default"]=s.exports}},[["1daf","common/runtime","common/vendor"]]]);